Bootstrap: docker
From: python:3.13-slim

%post
	apt-get update && apt-get install -y --no-install-recommends build-essential git curl golang

	git clone https://github.com/donnybeelo/sanger-movie-server
	cd sanger-movie-server

	pip install --no-cache-dir -r requirements.txt

	make build
	mv movie-server /usr/local/bin/

%runscript
	python3 client.py $@

%startscript
	movie-server $@

%help
	@echo "This is a Singularity container for the Movie Server/Client for the Sanger HCI take-home test"
	@echo ""
	@echo "Usage:"
	@echo "  singularity run [image-name] [options]"
	@echo ""
	@echo "Options:"
	@echo "  --server SERVER      Specify the server URL"
	@echo "  --port PORT          Specify the server port (default: 8080)"
	@echo "  --year YEAR          Specify the year to fetch movies for"
	@echo "  --username USERNAME  Specify the username for authentication"
	@echo "  --password PASSWORD  Specify the password for authentication"
	@echo "  --verbose            Enable verbose output"
	@echo ""
	@echo "Example:"
	@echo "  singularity run movie-server.sif --year 1900 --username user --password pass --verbose"
	@echo ""
	@echo "To start server:"
	@echo "  singularity instance start movie-server.sif [name] [options]"
	@echo "To stop server:"
	@echo "  singularity instance stop [name]"
	@echo ""
	@echo "Options:"
	@echo "  -port PORT          Specify the port for the server (default: 8080)"
	@echo ""
	@echo "Example:"
	@echo "  singularity instance start movie-server.sif my_server --port 8081"