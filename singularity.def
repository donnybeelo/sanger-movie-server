Bootstrap: docker
From: golang:1.24.7-alpine3.22
Stage: server

%post
	apk add --no-cache git make

	git clone -b v0.99 https://github.com/wtsi-hgi/movie-server server
	cd server

	sed 's/@go/\t@go/g' Makefile -i
	make build

Bootstrap: docker
From: python:3.13-slim
Stage: final

%post
	apt-get update && apt-get install -y --no-install-recommends git

	git clone https://github.com/donnybeelo/sanger-movie-server client
	cd client/client

	pip install --no-cache-dir -r requirements.txt

%files from server
	server/movie-server /usr/local/bin/movie-server
%files
	client/client/client.py /usr/local/bin/movie-client
%runscript
	movie-client $@

%startscript
	movie-server $@

%help
	This is a Singularity container for the Movie Server/Client for the Sanger HCI take-home test

	To run client:
	  singularity run [image-name] [options]
	Options:
	  --server SERVER      Specify the server URL
	  --port PORT          Specify the server port (default: 8080)
	  --year YEAR          Specify the year to fetch movies for
	  --username USERNAME  Specify the username for authentication
	  --password PASSWORD  Specify the password for authentication
	  --verbose            Enable verbose output (optional, dramatically decreases speed)
	Example:
	  singularity run movie-server.sif --server localhost --year 1900 --username user --password pass

	To start server:
	  singularity instance start movie-server.sif [name] [options]
	To stop server:
	  singularity instance stop [name]
	Options:
	  -port PORT          Specify the port for the server (default: 8080)
	Example:
	  singularity instance start movie-server.sif my_server -port 8081
