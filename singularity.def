Bootstrap: docker
From: alpine:3.22.1

%post
	apk add --no-cache make git go

	git clone -b go-gemini-conversion https://github.com/donnybeelo/sanger-movie-server
	cd sanger-movie-server

	go build -o /usr/local/bin/client client/client.go

	make build
	mv movie-server /usr/local/bin/

%runscript
	client $@

%startscript
	movie-server $@

%help
	This is a Singularity container for the Movie Server/Client for the Sanger HCI take-home test

	To run client:
	  singularity run [image-name] [options]
	Options:
	  --server SERVER      Specify the server URL
	  --port PORT          Specify the server port (default: 8080)
	  --year YEAR          Specify the year to fetch movies for
	  --username USERNAME  Specify the username for authentication
	  --password PASSWORD  Specify the password for authentication
	  --verbose            Enable verbose output (optional, dramatically decreases speed)
	Example:
	  singularity run movie-server.sif --server localhost --year 1900 --username user --password pass

	To start server:
	  singularity instance start movie-server.sif [name] [options]
	To stop server:
	  singularity instance stop [name]
	Options:
	  -port PORT          Specify the port for the server (default: 8080)
	Example:
	  singularity instance start movie-server.sif my_server -port 8081
